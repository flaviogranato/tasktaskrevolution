<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>
             Dashboard - microservico-java 
        </title>
        <link rel="stylesheet" href="style.css" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/frappe-gantt/dist/frappe-gantt.css"
        />
    </head>
    <body>
        <header>
            <h1>
                <a href="index.html"
                    >microservico-java</a
                >
            </h1>
            <nav>
                <a href="index.html">Dashboard</a>
                <a href="tasks.html">Tasks</a>
                <a href="resources.html">Resources</a>
            </nav>
        </header>

        <main>
<section id="app" v-cloak>
    <h2>Project Dashboard</h2>

    <div class="summary-cards">
        <div class="card">
            <h3>Total Tasks</h3>
            <p class="count">${ tasks.length }$</p>
        </div>
        <div class="card">
            <h3>Total Resources</h3>
            <p class="count">1</p>
        </div>
    </div>

    <div class="list-container">
        <h3>Gantt Chart (${ filteredTasks.length }$)</h3>
        <input
            type="text"
            v-model="searchQuery"
            placeholder="Filter tasks by name..."
            class="task-filter-input"
        />
        <div class="gantt-wrapper">
            <svg ref="ganttContainer"></svg>
        </div>
        <p v-if="filteredTasks.length === 0">No tasks match your filter.</p>
    </div>
</section>
</main>

        <footer>
            <p>
                Generated by TaskTaskRevolution on 2025-07-29 14:20
            </p>
        </footer>

        <!-- Adicionar Vue.js -->
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/frappe-gantt/dist/frappe-gantt.min.js"></script>
        
<script>
    const { createApp, ref, computed, watchEffect } = Vue;

    createApp({
        setup() {
            const searchQuery = ref('');
            const tasks = ref([{"actual_end_date":null,"assigned_resources":[],"code":"TASK-3","description":null,"due_date":"2024-01-10","id":"proj-1","name":"Minha Primeira Tarefa","project_code":"proj-1","start_date":"2024-01-01","status":"Planned"}]);
            const ganttContainer = ref(null);
            let ganttChart = null; // Not a ref, as we don't need gantt itself to be reactive

            const filteredTasks = computed(() => {
                if (!searchQuery.value) {
                    return tasks.value;
                }
                const lowerCaseQuery = searchQuery.value.toLowerCase();
                return tasks.value.filter(task =>
                    task.name.toLowerCase().includes(lowerCaseQuery)
                );
            });

            const ganttTasks = computed(() => {
                return filteredTasks.value.map(task => {
                    // Frappe Gantt requires a start and end date in 'YYYY-MM-DD' format.
                    // If a task lacks either, we cannot display it on the chart.
                    if (!task.start_date || !task.due_date) {
                        return null;
                    }

                    let progress = 0;
                    if (task.status.InProgress) {
                        progress = task.status.InProgress.progress;
                    } else if (task.status.Completed) {
                        progress = 100;
                    }

                    const isOverdue = new Date(task.due_date) < new Date() && !task.status.Completed;

                    const startDate = task.start_date.substring(0, 10);
                    const endDate = task.due_date.substring(0, 10);

                    return {
                        id: String(task.id),
                        name: task.name,
                        start: startDate,
                        end: endDate,
                        progress: progress,
                        custom_class: isOverdue ? 'bar-overdue' : ''
                    };
                }).filter(task => task); // Filter out null tasks
            });

            watchEffect(() => {
                if (ganttContainer.value) { // ensure container is mounted
                    if (!ganttChart && ganttTasks.value.length > 0) {
                        // Initialize chart if it doesn't exist and there are tasks
                        ganttChart = new Gantt(ganttContainer.value, ganttTasks.value, {
                            view_mode: 'Week',
                            language: 'en'
                        });
                    } else if (ganttChart) {
                        // Refresh existing chart. This will also clear the chart if ganttTasks is empty.
                        ganttChart.refresh(ganttTasks.value);
                    }
                }
            });

            return {
                searchQuery,
                tasks,
                filteredTasks,
                ganttContainer,
            };
        },
        delimiters: ['${', '}$'] // Change delimiters to avoid conflict with Tera
    }).mount('#app');
</script>
<style>
    [v-cloak] {
        display: none;
    }
    .task-filter-input {
        width: 100%;
        padding: 8px 10px;
        margin-bottom: 20px;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
    .gantt-wrapper {
        border: 1px solid #ddd;
        border-radius: 4px;
        overflow: hidden; /* To contain the rounded corners of the chart */
    }
    .gantt .bar-overdue .bar {
        fill: #e74c3c; /* A distinct red for overdue tasks */
    }
    .gantt .bar-overdue .bar-progress {
        fill: #c0392b;
    }
</style>

    </body>
</html>
