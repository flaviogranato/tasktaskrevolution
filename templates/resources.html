{% extends "base.html" %} {% block title %}Resources{% endblock title %} {%
block content %}
<section id="app" v-cloak>
    <h2>All Resources (${ filteredResources.length })</h2>

    <div class="list-container">
        <input
            type="text"
            v-model="searchQuery"
            placeholder="Filter resources by name..."
            class="resource-filter-input"
        />
        <ul>
            <li v-for="resource in filteredResources" :key="resource.id">
                <strong>${ resource.name }</strong> - ${ resource.resource_type
                }
                <div v-if="resource.email" class="email">
                    Email: ${ resource.email }
                </div>
                <div
                    v-if="resource.vacations && resource.vacations.length > 0"
                    class="vacations"
                >
                    <h4>Absences & Vacations:</h4>
                    <ul>
                        <li
                            v-for="period in resource.vacations"
                            :key="period.start_date"
                        >
                            <strong>${ period.period_type }</strong>:
                            <span
                                >${ new
                                Date(period.start_date).toLocaleDateString() } -
                                ${ new
                                Date(period.end_date).toLocaleDateString()
                                }</span
                            >
                            <span v-if="period.approved" class="status-approved"
                                >(Approved)</span
                            >
                            <span v-else class="status-pending">(Pending)</span>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
        <p v-if="filteredResources.length === 0">
            No resources match your filter.
        </p>
    </div>
</section>
{% endblock content %} {% block scripts %}
<script>
    const { createApp, ref, computed } = Vue;

    createApp({
        setup() {
            const searchQuery = ref('');
            // Safely inject the resources data from Tera as a JSON object
            const resources = ref({{ resources | json_encode() | safe }});

            const filteredResources = computed(() => {
                if (!searchQuery.value) {
                    return resources.value;
                }
                const lowerCaseQuery = searchQuery.value.toLowerCase();
                return resources.value.filter(resource =>
                    resource.name.toLowerCase().includes(lowerCaseQuery)
                );
            });

            return {
                searchQuery,
                resources,
                filteredResources,
            };
        },
        delimiters: ['${', '}$'] // Avoid conflict with Tera
    }).mount('#app');
</script>
<style>
    [v-cloak] {
        display: none;
    }
    .resource-filter-input {
        width: 100%;
        padding: 8px 10px;
        margin-bottom: 20px;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
    .email {
        font-size: 0.9em;
        color: #777;
        padding-left: 10px;
    }
    .vacations {
        margin-top: 10px;
        padding: 10px;
        background-color: #f9f9f9;
        border-radius: 4px;
        border: 1px solid #eee;
    }
    .vacations h4 {
        margin-top: 0;
        margin-bottom: 8px;
        font-size: 1em;
        color: #333;
        border-bottom: 1px solid #e0e0e0;
        padding-bottom: 5px;
    }
    .vacations ul {
        list-style-type: none;
        padding-left: 0;
    }
    .vacations li {
        padding: 4px 0;
        font-size: 0.95em;
    }
    .status-approved {
        color: #27ae60;
        font-weight: bold;
    }
    .status-pending {
        color: #f39c12;
        font-weight: bold;
    }
</style>
{% endblock scripts %}
