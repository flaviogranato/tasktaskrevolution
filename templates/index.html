{% extends "base.html" %} {% block title %} Dashboard - {{ super() }} {%
endblock title %} {% block content %}
<section id="app" v-cloak>
    <h2>Project Dashboard</h2>

    <div class="summary-cards">
        <div class="card">
            <h3>Total Tasks</h3>
            <p class="count">${ tasks.length }$</p>
        </div>
        <div class="card">
            <h3>Total Resources</h3>
            <p class="count">{{ resources | length }}</p>
        </div>
    </div>

    <div class="list-container">
        <h3>All Tasks (${ filteredTasks.length }$)</h3>
        <input
            type="text"
            v-model="searchQuery"
            placeholder="Filter tasks by name..."
            class="task-filter-input"
        />
        <ul>
            <li v-for="task in filteredTasks" :key="task.id">
                <strong>${ task.name }$</strong>
                <span v-if="task.status.InProgress"
                    >(In Progress: ${ task.status.InProgress.progress }%)</span
                >
                <span v-else-if="task.status.Completed">(Completed)</span>
                <span v-else-if="task.status.Planned">(Planned)</span>
                <span v-else-if="task.status.Blocked">(Blocked)</span>
                <span v-else-if="task.status.Cancelled">(Cancelled)</span>
                - Due: ${ task.due_date }$
            </li>
        </ul>
        <p v-if="filteredTasks.length === 0">No tasks match your filter.</p>
    </div>
</section>
{% endblock content %} {% block scripts %}
<script>
    const { createApp, ref, computed } = Vue;

    createApp({
        setup() {
            const searchQuery = ref('');
            // Use Tera to safely inject the tasks data as a JSON object
            const tasks = ref({{ tasks | json_encode() | safe }});

            const filteredTasks = computed(() => {
                if (!searchQuery.value) {
                    return tasks.value;
                }
                const lowerCaseQuery = searchQuery.value.toLowerCase();
                return tasks.value.filter(task =>
                    task.name.toLowerCase().includes(lowerCaseQuery)
                );
            });

            return {
                searchQuery,
                tasks,
                filteredTasks,
            };
        },
        delimiters: ['${', '}$'] // Change delimiters to avoid conflict with Tera
    }).mount('#app');
</script>
<style>
    [v-cloak] {
        display: none;
    }
    .task-filter-input {
        width: 100%;
        padding: 8px 10px;
        margin-bottom: 20px;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
    }
</style>
{% endblock scripts %}
